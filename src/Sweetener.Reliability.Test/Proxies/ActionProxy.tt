<#@ template debug="false" hostspecific="true" language="C#" #>
<#@ output extension=".cs" #>
<#@ assembly name="System.Core" #>
<#@ import namespace="System" #>
<#@ include file="..\TextTemplating\Include.t4" #>// Generated from <#= GetTemplateFileName() #>
using System;

namespace Sweetener.Reliability.Test
{
<#
    for (int parameterCount = 0; parameterCount <= MaxDelegateParameters; parameterCount++)
    {
        string optionalComma      = parameterCount > 0 ? ", " : string.Empty;
        string arguments          = GetArguments     (parameterCount);
        string parameters         = GetParameters    (parameterCount);
        string typeParameters     = GetTypeParameters(parameterCount);
        string typeParametersCode = parameterCount > 0 ? "<" + GetTypeParameters(parameterCount) + ">" : string.Empty;
#>
    #region ActionProxy<#= typeParametersCode #>

    internal sealed class ActionProxy<#= typeParametersCode #> : DelegateProxy
    {
        public event Action<<#= typeParameters #><#= optionalComma #>CallContext> Invoking;

        private readonly Action<#= typeParametersCode #> _action;

        public ActionProxy()
            : this((<#= arguments #>) => Operation.Null())
        { }

        public ActionProxy(Action<#= typeParametersCode #> action)
        {
            _action = action ?? throw new ArgumentNullException(nameof(action));
        }

        public void Invoke(<#= parameters #>)
        {
            UpdateContext();

            Invoking?.Invoke(<#= arguments #><#= optionalComma #>_context);
            _action(<#= arguments #>);
        }
    }

    #endregion

<#
    }
#>
}
